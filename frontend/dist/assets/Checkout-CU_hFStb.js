import{j as e,c as _,U as $,u as L,Y as K,V as Q,r as a,a as R,M as v,B as i,t,Z as z}from"./index-B1oV26O_.js";import{C as r}from"./card-B9CT9kl6.js";import{C as b}from"./checkbox-BNfEHxqN.js";import{u as B}from"./useInfiniteQuery-DwGHqOW6.js";import{A as Y,f as V}from"./AddressForm-XqLXxjdW.js";import{D as Z,C as G}from"./DeliverySpinner-1e4T4Sb6.js";import{i as H}from"./payment-BCqJTHO5.js";import{C as J}from"./clock-Dc5_ZgE6.js";import"./select-ch-XkfZw.js";import"./form-By8UDPlK.js";import"./switch-pXwgQpIw.js";import"./input-CD-JPfev.js";import"./proxy-0Xk5Xy8A.js";function W({className:l,...n}){return e.jsx("textarea",{"data-slot":"textarea",className:_("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",l),...n})}function ue(){const l=$(),n=L(),w=K(),{items:c,totalAmount:d}=Q(s=>s.cart),[P,h]=a.useState(!1),[o,C]=a.useState(null),[p,D]=a.useState(""),[m,S]=a.useState(null),[f,A]=a.useState("Cash on Delivery"),{data:x,fetchNextPage:k,hasNextPage:F,isFetchingNextPage:g,isLoading:I,isError:M,error:T}=B({queryKey:["addresses"],queryFn:({pageParam:s=1})=>V(s),initialPageParam:1,getNextPageParam:(s,y)=>s.totalPages>y.length?y.length+1:void 0,retry:!1,staleTime:1e3*60*5}),U=(x==null?void 0:x.pages.flatMap(s=>s.data))||[],{mutate:q,isPending:E}=R({mutationKey:["orders"],mutationFn:H,onSuccess:s=>{w.invalidateQueries({queryKey:["orders"]}),t.success("Order placed successfully!"),l(z()),console.log(s),n(`/order-confirmation/${s==null?void 0:s.orderId}`)},onError:s=>{t.error("Uh oh! Something went wrong.",{description:s.message||"Failed to place order. Please try again."})}}),O=()=>{if(c.length===0){t.error("Uh oh! Something went wrong.",{description:"Your cart is empty. Please add items before placing an order."});return}if(!o){t.error("Uh oh! Something went wrong.",{description:"Please select a delivery address."});return}if(!m){t.error("Uh oh! Something went wrong.",{description:"Please select a delivery time."});return}const s={addressId:o,deliveryTime:m,deliveryInstructions:p,menuItems:c,amount:u,MUID:"MUID"+Date.now(),transactionId:"T"+Date.now(),paymentMethod:f};q(s)},j=20,N=Math.round(d*.05),u=d+j+N;return e.jsxs("div",{className:"container max-w-6xl mx-auto lg:w-6xl w-dvw md-p-0 p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Checkout"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(r,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(v,{className:"h-5 w-5 text-primary"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Delivery Address"})]}),I?e.jsx("div",{className:"flex flex-col items-center justify-center h-[300px] space-y-4 lg:w-3xl md:w-2xs w-dvw p-4 md:p-0",children:e.jsx(Z,{})}):M?e.jsx("p",{className:"text-red-500",children:T.message}):e.jsx("div",{className:"space-y-4",children:U.map(s=>e.jsxs("div",{className:"flex items-start gap-4 p-4 border rounded-lg hover:border-primary transition-colors",children:[e.jsx(b,{id:`address-${s._id}`,checked:o===s._id,onCheckedChange:()=>C(s._id)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{htmlFor:`address-${s._id}`,className:"flex items-center gap-2 font-medium cursor-pointer",children:[s==null?void 0:s.type,s.isDefault&&e.jsx("span",{className:"text-xs bg-primary/10 text-primary px-2 py-0.5 rounded",children:"Default"})]}),e.jsx("h3",{className:"font-semibold",children:s.receiverName}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.address}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Phone: ",s.phoneNumber]})]})]},s._id))}),F&&e.jsx(i,{variant:"outline",className:"mt-4 w-full",onClick:()=>k(),disabled:g,children:g?"Loading more...":"Load More Addresses"}),e.jsx(i,{className:"w-full mt-6",onClick:()=>h(!0),children:"Add New Address"})]}),e.jsxs(r,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(v,{className:"h-5 w-5 text-primary"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Delivery Instructions"})]}),e.jsx(W,{placeholder:"E.g., Leave at the doorstep, call upon arrival...",value:p,onChange:s=>D(s.target.value),className:"w-full"})]}),e.jsxs(r,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(J,{className:"h-5 w-5 text-primary"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Delivery Time"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:["ASAP","30-45 min","45-60 min"].map(s=>e.jsx(i,{variant:m===s?"default":"outline",className:"w-full",onClick:()=>S(s),children:s},s))})]}),e.jsx(Y,{openAddressForm:P,setOpenAddressForm:h}),e.jsxs(r,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(G,{className:"h-5 w-5 text-primary"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Payment Method"})]}),e.jsx("div",{className:"space-y-3",children:["Credit/Debit Card","PhonePe UPI","Cash on Delivery"].map(s=>e.jsxs("div",{className:"flex items-center gap-4 p-4 border rounded-lg hover:border-primary transition-colors",children:[e.jsx(b,{id:`payment-${s}`,checked:f===s,disabled:s!=="Cash on Delivery",onCheckedChange:()=>A(s)}),e.jsx("label",{htmlFor:`payment-${s}`,className:"font-medium cursor-pointer",children:s})]},s))})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(r,{className:"p-6 sticky top-4",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Order Summary"}),e.jsxs("div",{className:"space-y-4",children:[c.map(s=>e.jsxs("div",{className:"flex justify-between items-start py-2 border-b",children:[e.jsxs("div",{className:"flex gap-2 flex-col items-start",children:[e.jsxs("div",{className:"flex justify-start items-center gap-2",children:[e.jsxs("div",{className:"font-medium",children:[s.quantity,"x"]}),e.jsx("p",{className:"font-medium",children:s.item.name})]}),e.jsxs("div",{className:"flex justify-start items-center gap-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.restaurant.name," -"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["₹",s.item.price," each"]})]})]}),e.jsxs("p",{className:"font-medium",children:["₹",s.item.price*s.quantity]})]},s.item._id)),e.jsxs("div",{className:"space-y-2 pt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Subtotal"}),e.jsxs("span",{children:["₹",d]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Delivery Fee"}),e.jsxs("span",{children:["₹",j]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Tax & Platform Fee (5%)"}),e.jsxs("span",{children:["₹",N]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-semibold pt-2 border-t",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["₹",u]})]})]})]}),e.jsx(i,{className:"w-full mt-6",size:"lg",onClick:O,children:E?e.jsxs("span",{className:"flex gap-1 items-center",children:[e.jsx("span",{className:"dot w-2 h-2 bg-white rounded-full animate-bounce [animation-delay:-0.2s]"}),e.jsx("span",{className:"dot w-2 h-2 bg-white rounded-full animate-bounce [animation-delay:-0.1s]"}),e.jsx("span",{className:"dot w-2 h-2 bg-white rounded-full animate-bounce"})]}):`Place Order • ₹${u}`})]})})]})]})}export{ue as default};
